{"is_source_file": true, "format": "Python", "description": "This file is a FastAPI server implementation for a weather search backend. It defines API endpoints to check service health and to fetch current weather data from the OpenWeatherMap API, normalizing the response for frontend consumption. It includes data models, internal helper functions for payload normalization and data fetching, and route handlers for GET and POST requests.", "external_files": ["httpx", "fastapi", "fastapi.middleware.cors", "pydantic", "os"], "external_methods": ["httpx.AsyncClient", "httpx.RequestError", "fastapi.FastAPI", "fastapi.HTTPException", "fastapi.Body", "fastapi.Query", "fastapi.middleware.cors.CORSMiddleware", "pydantic.BaseModel", "pydantic.Field"], "published": ["app", "health_check", "get_weather", "post_weather"], "classes": [{"name": "WeatherResponse", "description": "Normalized weather response consumed by the frontend.", "fields": [{"name": "city", "description": "City name used for the query (as returned by OpenWeatherMap)."}, {"name": "temperature", "description": "Current temperature in Celsius."}, {"name": "humidity", "description": "Current humidity percentage."}, {"name": "description", "description": "Short weather description (e.g., 'clear sky')."}]}, {"name": "WeatherRequest", "description": "POST request body for weather query.", "fields": [{"name": "city", "description": "City name to lookup (e.g., 'London')."}]}], "methods": [{"name": "WeatherResponse _normalize_openweather_payload(payload: Dict[str, Any])", "description": "Converts OpenWeatherMap payload into a normalized WeatherResponse object, raising HTTPException if payload format is unexpected.", "scope": "", "scopeKind": ""}, {"name": "WeatherResponse _fetch_current_weather(city: str, api_key: str)", "description": "Fetches weather data asynchronously from OpenWeatherMap API for a given city, handling errors and returning normalized data.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,str] health_check()", "description": "Health check endpoint returning a simple 'Healthy' message.", "scope": "", "scopeKind": ""}, {"name": "WeatherResponse get_weather(city: str = Query(..., min_length=1, description=\"City name (e.g., 'London').\"))", "description": "Handles GET requests to fetch current weather based on a city query parameter.", "scope": "", "scopeKind": ""}, {"name": "WeatherResponse post_weather(payload: WeatherRequest = Body(...))", "description": "Handles POST requests to fetch current weather based on a JSON payload containing the city.", "scope": "", "scopeKind": ""}], "calls": ["httpx.AsyncClient", "httpx.RequestError", "resp.json", "_normalize_openweather_payload", "_fetch_current_weather"], "search-terms": ["FastAPI", "WeatherResponse", "OpenWeatherMap", "API endpoints", "CORS middleware", "Health check", "fetch weather", "normalize payload"], "state": 2, "file_id": 1, "knowledge_revision": 15, "git_revision": "67907439b81687e5e087d23483124f84b958052b", "revision_history": [{"8": "66ea8fb18d7606d187d4444cd7c6d4a5be282175"}, {"10": "66ea8fb18d7606d187d4444cd7c6d4a5be282175"}, {"15": "67907439b81687e5e087d23483124f84b958052b"}], "ctags": [{"_type": "tag", "name": "OPENWEATHER_CURRENT_URL", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^OPENWEATHER_CURRENT_URL = \"https:\\/\\/api.openweathermap.org\\/data\\/2.5\\/weather\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "WeatherRequest", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^class WeatherRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "WeatherResponse", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^class WeatherResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_fetch_current_weather", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^async def _fetch_current_weather(city: str, api_key: str) -> WeatherResponse:$/", "language": "Python", "typeref": "typename:WeatherResponse", "kind": "function", "signature": "(city: str, api_key: str)"}, {"_type": "tag", "name": "_normalize_openweather_payload", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^def _normalize_openweather_payload(payload: Dict[str, Any]) -> WeatherResponse:$/", "language": "Python", "typeref": "typename:WeatherResponse", "kind": "function", "signature": "(payload: Dict[str, Any])"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "city", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^    city: str = Field(..., description=\"City name used for the query (as returned by OpenWeather/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "WeatherResponse", "scopeKind": "class"}, {"_type": "tag", "name": "city", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^    city: str = Field(..., min_length=1, description=\"City name to lookup (e.g., 'London').\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "WeatherRequest", "scopeKind": "class"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^    description: str = Field(..., description=\"Short weather description (e.g., 'clear sky').\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "WeatherResponse", "scopeKind": "class"}, {"_type": "tag", "name": "get_weather", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^async def get_weather(city: str = Query(..., min_length=1, description=\"City name (e.g., 'London/", "language": "Python", "typeref": "typename:WeatherResponse", "kind": "function", "signature": "(city: str = Query(..., min_length=1, description=\"City name (e.g., 'London').\"))"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^def health_check() -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "humidity", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^    humidity: int = Field(..., description=\"Current humidity percentage.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "WeatherResponse", "scopeKind": "class"}, {"_type": "tag", "name": "openapi_tags", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^openapi_tags = [$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "post_weather", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^async def post_weather(payload: WeatherRequest = Body(...)) -> WeatherResponse:$/", "language": "Python", "typeref": "typename:WeatherResponse", "kind": "function", "signature": "(payload: WeatherRequest = Body(...))"}, {"_type": "tag", "name": "temperature", "path": "/home/kavia/workspace/code-generation/weather-search-app-6692-6704/weather_backend/src/api/main.py", "pattern": "/^    temperature: float = Field(..., description=\"Current temperature in Celsius.\")$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "WeatherResponse", "scopeKind": "class"}], "hash": "699f2c74f23d55d12be18371469dee00", "format-version": 4, "code-base-name": "weather_backend", "filename": "weather_backend/src/api/main.py", "fields": [{"name": "OPENWEATHER_CURRENT_URL = \"https:\\/\\/api.openweathermap.org\\/data\\/2.5\\/weather\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str city", "scope": "WeatherResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str description", "scope": "WeatherResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int humidity", "scope": "WeatherResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "openapi_tags = [", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "float temperature", "scope": "WeatherResponse", "scopeKind": "class", "description": "unavailable"}]}